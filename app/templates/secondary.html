<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/style.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>


    <main>
       <div class=" d-flex flex-column flex-shrink-0 p-3 text-white bg-dark" style="width: 280px; min-height: 100vh;">
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a id="plus" class="nav-link active" >
              <svg class="bi me-2" width="40" height="16"><use xlink:href="#home"></use></svg>
            Add
            </a>
          </li>
          <li>
            <a href="http://localhost:8000" class="nav-link text-white ">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#speedometer2"></use></svg>
            Top
            </a>
          </li>
          <li>
            <a href="#" class="nav-link text-white">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#table"></use></svg>
              Secondary
            </a>
          </li>
          
        </ul>
        <hr>
      </div>

      

      <div class="flex" style="width: 100%; padding: 10px;">


        <div class="modallll" id="modallll">
          <div class="modal_child">
              <i class="fa-sharp fa-regular fa-circle-xmark close" id="close"></i>
              <h4>Add Task</h4>

              <form id="form">
                  <input required type="text" id="tasktitle" placeholder="Enter task title" />

                  <label>Enter start time</label>
                  <input required type="datetime-local" placeholder="Enter start time" id="startt" />

                  <label>Enter end time</label>
                  <input required type="datetime-local" placeholder="Enter end time" id="endt" />

                  <select required id="prority">
                      <option selected>Please choose task type</option>
                      <option value="P">Top task</option>
                      <option value="S">Secondary</option>
                  </select>

                  <textarea required placeholder="Enter task description" id="taskdes"></textarea>

                  <button type="submit" id="submittask">Add</button>
              </form>

          </div>

      </div>


      <div class="modallll" id="modallllupdate">
          <div class="modal_child">
              <i class="fa-sharp fa-regular fa-circle-xmark close" id="closeupdate"></i>
              <h4>Update Task</h4>

              <form id="form">
                  <input required type="text" id="tasktitleupdate" placeholder="Enter task title" />

                  <label>Enter start time</label>
                  <input required type="datetime-local" placeholder="Enter start time" id="starttupdate" />

                  <label>Enter end time</label>
                  <input required type="datetime-local" placeholder="Enter end time" id="endtupdate" />

                  <select required id="prorityupdate">
                      <option selected>Please choose task type</option>
                      <option value="P">Top task</option>
                      <option value="S">Secondary</option>
                  </select>

                  <textarea required placeholder="Enter task description" id="taskdesupdate"></textarea>

                  <button type="submit" id="updatetask">Update</button>
              </form>

          </div>

      </div>

        <div class="d-grid gap-2">
            <button class="btn btn-primary" type="button">SECONDARY TASK</button>
  
          </div>

    
      <table id="table" class="table  table-bordered table-striped" style="width: 100%; margin-top: 20px; border-radius: 10px;">
        <thead>
          <tr>
            <th scope="col">Id</th>
            <th scope="col">Task</th>
            <th scope="col">Description</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="displayTable">
      
        </tbody>
      </table>

      <div id="card" class="card card-secondary card_pop"  style="margin-top: 20px; opacity: 1;">
        <div  class="card-body">
          <h5 class="card-title">No Secondary Tasks</h5>
          <p class="card-text">You don't have a secondary task ,Please go ahead and add a task</p>
        </div>
      </div>

       </div>

     </div>
    </main>




    <script>

      
     let idforupdate;

        function close() {
            console.log("closing")
            document.getElementById("modallll").style.display = "none";
        }

        function openmodal() {
            console.log("opening")

            document.getElementById("modallll").style.display = "flex";
        }

        function closeUpdate() {
            console.log("closing")
            document.getElementById("modallllupdate").style.display = "none";
        }

        function openUpdate() {
            document.getElementById("modallllupdate").style.display = "flex";
        }



        document.getElementById("updatetask").addEventListener("click", Update);

        document.getElementById("closeupdate").addEventListener("click", closeUpdate)

        document.getElementById("plus").addEventListener("click", openmodal);
        document.getElementById("close").addEventListener("click", close);
        document.getElementById("submittask").addEventListener("click", addTask);
        



        function displayTasks(arr) {
            document.getElementById("displayTable").innerHTML = "";

            arr.forEach(function (task, index) {
                let row = document.createElement("tr");

                let id = document.createElement("td");
                id.append(index + 1);

                let title = document.createElement("td");
                title.append(task.task_name);

                let description = document.createElement("td");
                description.append(task.task_description);

                let actions = document.createElement("td");


                let edit = document.createElement("i");
                edit.classList.add("fa-solid");
                edit.classList.add("fa-pen-to-square");
                // edit.classList.add("blue")
                edit.onclick = setUpdate.bind(this, task.task_id, arr);
                actions.appendChild(edit);


                let trash = document.createElement("i");
                trash.classList.add("fa-solid");
                trash.classList.add("fa-trash");
                // trash.classList.add("closesss");
                trash.onclick = deleteTask.bind(this, task.task_id);
                actions.appendChild(trash);


                row.appendChild(id);
                row.appendChild(title);
                row.appendChild(description);
                row.appendChild(actions);

                document.getElementById("displayTable").appendChild(row);
            })


        }

        function loadSecondary() {
            fetch("http://localhost:8000/tasks/secondary", {
                method: "GET"
            })
                .then(function (res) {
                    return res.json()
                })
                .then(function (response) {
                    console.log(response);
                    let secondaryTasks = response;

                    if(secondaryTasks.length===0){
                      document.getElementById("table").style.display="none";
                        document.getElementById("card").style.color="black";
                        document.getElementById("card").style.border="1px solid black";
                    }

                    displayTasks(secondaryTasks)
                })
                .catch(function (err) {
                    console.log(err);

                })
        }

        document.addEventListener("DOMContentLoaded", function () {
            loadSecondary();
        });


        function deleteTask(id) {

fetch("http://localhost:8000/tasks/remove/" + id, {
    method: "DELETE"
})
    .then(function (res) {
        return res.json()
    })
    .then(function (response) {
        console.log(response)

        alert("Task successfully deleted");

        location.reload()

    })
    .catch(function (err) {
        console.log(err);
    })
}



        function addTask() {
            let task = {

            }
            task.task_name = document.getElementById("tasktitle").value
            task.task_description = document.getElementById("taskdes").value
            task.startT = document.getElementById("startt").value;
            task.endT = document.getElementById("endt").value;
            task.priority = document.getElementById("prority").value;
            console.log(task)


           

            fetch("http://localhost:8000/tasks/", {
                method: "POST",
                headers: {
                    "content-type": "application/json"
                },
                body: JSON.stringify(task)
            })
                .then(function (res) {
                    return res.json()
                })
                .then(function (response) {
                    console.log(response)


                    if (response.detail === "Cannot create more than 3 top task") {
                        alert(response.detail)
                    }
                    else {
                        alert("Tasks has been successfully added");
                    }
                    location.reload()
                    document.getElementById("form").reset();
                })
                .catch(function (err) {
                    console.log(err)
                })
           }


           function Update() {
            let task = {

            }
            task.task_name = document.getElementById("tasktitleupdate").value
            task.task_description = document.getElementById("taskdesupdate").value
            task.startT = document.getElementById("starttupdate").value;
            task.endT = document.getElementById("endtupdate").value;
            task.priority = document.getElementById("prorityupdate").value;
            console.log(task)

            fetch("http://localhost:8000/tasks/update/" + idforupdate, {
                method: "PUT",
                headers: {
                    "content-type": 'application/json'
                },
                body: JSON.stringify(task)
            })
                .then(function (res) {
                    return res.json()
                })
                .then(function (response) {
                    console.log(response);


                    
                    alert("Task successfully updated")

                    loadTop()

                    closeUpdate()
                    
                })
                .catch(function (err) {
                    console.log(err);

                })

        }

        function setUpdate(id, array) {
            openUpdate();
            let task = array.find(function (a, i) {
                return id === a.task_id
            })
            // console.log(task);

            document.getElementById("tasktitleupdate").value = task.task_name;
            document.getElementById("starttupdate").value = task.startT;
            document.getElementById("endtupdate").value = task.endT;
            document.getElementById("prorityupdate").value = task.priority;
            document.getElementById("taskdesupdate").value = task.task_description;

            idforupdate=id;

        }
    </script>

    
</body>
</html>


